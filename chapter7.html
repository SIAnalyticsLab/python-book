<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chapter 7 — Reshaping & Joining Data</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  margin: 0;
  color: #0F172A;
  line-height: 1.7;
}

header {
  background: #0F766E;
  color: white;
  padding: 40px;
}

nav {
  background: #0F172A;
  padding: 15px;
}

nav a {
  color: #FACC15;
  margin-right: 15px;
  text-decoration: none;
  font-weight: bold;
}

main {
  max-width: 900px;
  margin: auto;
  padding: 40px;
}

h2, h3 {
  color: #0F766E;
}

pre {
  background: #f3f4f6;
  padding: 15px;
  overflow-x: auto;
}

code {
  background: #f3f4f6;
  padding: 2px 6px;
}

table {
  border-collapse: collapse;
  margin: 20px 0;
}

table th, table td {
  border: 1px solid #d1d5db;
  padding: 10px;
  text-align: left;
}

.callout {
  background: #f9fafb;
  border-left: 4px solid #0F766E;
  padding: 15px;
  margin: 25px 0;
}

footer {
  background: #0F172A;
  color: white;
  text-align: center;
  padding: 20px;
}
</style>
</head>

<body>

<header>
  <h1>Chapter 7 — Reshaping & Joining Data</h1>
  <p><strong>Python for Data Analysis & Visualization</strong></p>
  <p>Strategic Insights & Analytics (SI Analytics)</p>
  <p><em>Empowering Decisions. Driving Innovation.</em></p>
</header>

<nav>
  <a href="chapter6.html">← Chapter 6</a>
  <a href="index.html">Home</a>
  <a href="chapter8.html">Chapter 8 →</a>
</nav>

<main>

<h2>Learning Objectives</h2>
<p>By the end of this chapter, you will be able to:</p>
<ul>
  <li>Explain what reshaping data means and why it is necessary</li>
  <li>Distinguish between wide and long data formats</li>
  <li>Use <code>melt()</code> to convert wide data to long format</li>
  <li>Use <code>pivot()</code> and <code>pivot_table()</code> to reshape data</li>
  <li>Join datasets using <code>pd.merge()</code></li>
  <li>Understand one-to-one, one-to-many, and many-to-many joins</li>
  <li>Perform joins using multiple keys</li>
  <li>Identify and handle mismatched keys during joins</li>
  <li>Avoid common beginner mistakes</li>
  <li>Explain why reshaping and joins are critical in real projects</li>
</ul>

<hr>

<h2>1. Why Reshaping and Joining Matter</h2>

<p>
In Chapter 6, you worked with one dataset at a time.  
In real projects, this is rarely enough.
</p>

<p>Real-world analysis often requires you to:</p>
<ul>
  <li>Combine datasets from different sources</li>
  <li>Align indicators across time and geography</li>
  <li>Prepare data for charts and dashboards</li>
</ul>

<p>Two problems appear repeatedly:</p>
<ul>
  <li>The data shape is wrong</li>
  <li>The data is split across multiple tables</li>
</ul>

<p>
This chapter solves both.
</p>

<hr>

<h2>2. Understanding Data Shapes: Wide vs Long</h2>

<h3>Wide Format</h3>

<p>Wide data spreads values across multiple columns.</p>

<table>
<tr>
<th>country</th>
<th>cases_2020</th>
<th>cases_2021</th>
</tr>
<tr>
<td>Nigeria</td>
<td>12000</td>
<td>15000</td>
</tr>
</table>

<p>Wide format is:</p>
<ul>
  <li>Easy to read</li>
  <li>Harder to analyze</li>
  <li>Difficult to visualize</li>
</ul>

<h3>Long Format</h3>

<table>
<tr>
<th>country</th>
<th>year</th>
<th>cases</th>
</tr>
<tr>
<td>Nigeria</td>
<td>2020</td>
<td>12000</td>
</tr>
<tr>
<td>Nigeria</td>
<td>2021</td>
<td>15000</td>
</tr>
</table>

<p>Long format is:</p>
<ul>
  <li>Ideal for analysis</li>
  <li>Required for most visualizations</li>
  <li>Preferred by Pandas, Plotly, and Quarto</li>
</ul>

<p><strong>Rule of thumb:</strong><br>
Humans like wide data. Computers prefer long data.
</p>

<hr>

<h2>3. Reshaping Data with <code>melt()</code></h2>

<pre><code>import pandas as pd

data = {
    "country": ["Nigeria", "Kenya"],
    "cases_2020": [12000, 8000],
    "cases_2021": [15000, 9000]
}

df_wide = pd.DataFrame(data)
df_wide</code></pre>

<h3>Using <code>melt()</code></h3>

<pre><code>df_long = pd.melt(
    df_wide,
    id_vars="country",
    var_name="year",
    value_name="cases"
)</code></pre>

<p>What happened?</p>
<ul>
  <li><code>country</code> stays fixed</li>
  <li>Column names move into <code>year</code></li>
  <li>Values move into <code>cases</code></li>
</ul>

<h3>Cleaning the Result</h3>

<pre><code>df_long["year"] = (
    df_long["year"]
    .str.replace("cases_", "")
    .astype(int)
)</code></pre>

<p>Now the data is analysis-ready.</p>

<div class="callout">
<strong>Try This Yourself</strong>
<p>Create a wide dataset with three years and reshape it using <code>melt()</code>.</p>
</div>

<hr>

<h2>4. Reshaping Back with <code>pivot()</code></h2>

<pre><code>df_wide_again = df_long.pivot(
    index="country",
    columns="year",
    values="cases"
)</code></pre>

<p>This reconstructs the wide format.</p>

<h3>When to Use <code>pivot_table()</code></h3>

<p>Use <code>pivot_table()</code> when:</p>
<ul>
  <li>There are duplicates</li>
  <li>You need aggregation</li>
</ul>

<pre><code>df_long.pivot_table(
    index="country",
    columns="year",
    values="cases",
    aggfunc="sum"
)</code></pre>

<hr>

<h2>5. Why Reshaping Matters for Visualization</h2>

<p>
Most plotting libraries expect <strong>long data</strong>.
</p>

<p>
If your chart “doesn’t work,” the problem is often:
</p>

<blockquote>The data shape is wrong.</blockquote>

<p>
Understanding reshaping saves hours of frustration.
</p>

<hr>

<h2>6. Joining Datasets: The Big Picture</h2>

<p>
Joining means adding columns from one dataset to another using shared keys.
</p>

<p>
Think of keys as <strong>connectors</strong>.
</p>

<hr>

<h2>7. Loading Two Real Datasets</h2>

<pre><code>malaria_url = "https://raw.githubusercontent.com/SIAnalyticsLab/30daychallengeguide/main/malaria.csv"
pop_url = "https://raw.githubusercontent.com/SIAnalyticsLab/30daychallengeguide/main/recent_pop_data.csv"

malaria = pd.read_csv(malaria_url)
population = pd.read_csv(pop_url)</code></pre>

<pre><code>malaria.head()
population.head()</code></pre>

<hr>

<h2>8. Joining with <code>pd.merge()</code></h2>

<h3>Basic Join</h3>

<pre><code>merged_df = pd.merge(
    malaria,
    population,
    on="country",
    how="left"
)</code></pre>

<h3>Understanding Join Types</h3>

<table>
<tr>
<th>Type</th>
<th>Meaning</th>
</tr>
<tr>
<td>left</td>
<td>Keep all rows from left dataset</td>
</tr>
<tr>
<td>right</td>
<td>Keep all rows from right dataset</td>
</tr>
<tr>
<td>inner</td>
<td>Keep only matching rows</td>
</tr>
<tr>
<td>outer</td>
<td>Keep all rows from both</td>
</tr>
</table>

<p>For analysis, <strong>left joins</strong> are most common.</p>

<hr>

<h2>9. One-to-Many Joins</h2>

<p>
One country appears once in population data but many times in malaria data.
</p>

<p>
This is normal and expected. Pandas handles it automatically.
</p>

<hr>

<h2>10. Joining on Multiple Keys</h2>

<pre><code>pd.merge(
    malaria,
    population,
    on=["country", "year"],
    how="left"
)</code></pre>

<p>This ensures correct alignment.</p>

<hr>

<h2>11. Handling Mismatched Keys</h2>

<h3>Checking for Missing Matches</h3>

<pre><code>merged_df.isna().sum()</code></pre>

<p>Missing values often mean:</p>
<ul>
  <li>Country names differ</li>
  <li>Years do not align</li>
  <li>Typos exist</li>
</ul>

<h3>Common Fixes</h3>

<pre><code>malaria["country"] = malaria["country"].str.strip()
population["country"] = population["country"].str.strip()</code></pre>

<p>Consistency is everything.</p>

<hr>

<h2>12. Common Beginner Mistakes</h2>

<ul>
  <li>❌ Joining without inspecting keys</li>
  <li>❌ Using the wrong join type</li>
  <li>❌ Ignoring missing values after joins</li>
  <li>❌ Assuming row counts remain unchanged</li>
</ul>

<hr>

<h2>Why This Chapter Matters in Real Projects</h2>

<ul>
  <li>Multiple datasets</li>
  <li>Clean joins</li>
  <li>Correct reshaping</li>
</ul>

<p>
Dashboards and reports fail silently when joins are wrong.
Mastering this chapter makes you reliable as an analyst.
</p>

<hr>

<h2>Video Placeholder — SI Analytics (Final videos coming soon)</h2>
<p><em>Reshaping & Joining Data for Analysis</em></p>

<hr>

<h2>Mini Challenge</h2>

<ul>
  <li>Reshape a wide dataset to long format</li>
  <li>Join malaria data with population data</li>
  <li>Create cases per 100,000 population</li>
  <li>Identify missing values after the join</li>
</ul>

<hr>

<h2>Reflection Questions</h2>

<ul>
  <li>Why do visualization tools prefer long data?</li>
  <li>When would you use <code>pivot_table()</code> instead of <code>pivot()</code>?</li>
  <li>Why is checking for missing values critical?</li>
</ul>

<hr>

<h2>End-of-Chapter Recap</h2>

<ul>
  <li>The difference between wide and long data</li>
  <li>How to reshape data using <code>melt()</code> and <code>pivot()</code></li>
  <li>How to join datasets with <code>pd.merge()</code></li>
  <li>How to handle one-to-many and multi-key joins</li>
  <li>How to fix mismatched keys</li>
</ul>

<p><strong>You are now ready to turn clean data into insight through visualization.</strong></p>

</main>

<footer>
  © Strategic Insights & Analytics (SI Analytics)
</footer>

</body>
</html>

